<html>
<head>
<title>CS6640 Danny Perry - Hough Transform </title>
</head>
<!-- libs -->
<script type="text/javascript" src="LaTeXMathML.js"></script>

<!-- css -->
<!--
<link rel="stylesheet" type="text/css" href="style.css"></link>
-->
<style>
img {width:500px;}
#image {width:300px;}
#section {width: 900px;}
table {max-width:810px;}
p {background: #ccc; padding: 9px; border-radius: 15px;}
</style>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35081386-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


<body>

<div id="section">
<h1>Hough Transforms</h1>
<h2>Daniel Perry</h2>
<ul>
<li>Code is written in matlab</li>
<li>I've included a file <a href="main.m">main.m</a> that creates all the graphs and derived images shown below.</li>
</ul>
</div>

<div id="section">
<h2>Hough Transform for Straight Lines</h2>
<div id="section_code">
  <h3>CODE:</h3>
<div style="background: #ccc; padding: 9px; border-radius: 15px;">
<h3>Hough Transform</h3>
<ul>
<li><a href="hough.m">hough.m</a> - creates the accumulator image for straight lines.</li>
<li><a href="hough_decrement.m">hough_decrement.m</a> - same, but also runs a "decrement" phase as described in [1].</li>
<li><a href="hough_orientation.m">hough_orientation.m</a> - same, but uses the edge orientation to limit parameter space search.</li>
<li><a href="findmaxima.m">findmaxima.m</a> - locates maxima in the accumulator image.</li>
<li><a href="drawlines.m">drawlines.m</a> - draws the lines from parameters on original image.</li>
<li><a href="drawpoints.m">drawpoints.m</a> - draws the parameters on accumulator image.</li>
</ul>
</div>
<br>
<div style="background: #ccc; padding: 9px; border-radius: 15px;">
<h3>Smoothing and Edge Detection (reused from previous project)</h3>
<ul>
<li><a href="edges/makeDiff1D.m">makeDiff1D.m</a> - creates a 1D derivative estimation filter.</li>
<li><a href="edges/makeGauss1D.m">makeGauss1D.m</a> - creates a 1D Gaussian smoothing filter.</li>
<li><a href="edges/convolve.m">convolve.m</a> - convolves a separable 1D filter and an image in both directions.</li>
<li><a href="edges/convolve1D.m">convolve1D.m</a> - convolves a 1D filter and an image in one direction.</li>
<li><a href="edges/edgeMap.m">edgeMap.m</a> - generates the edge map (ie gradient magnitude) of an image.  This function makes use of the derivative code above as well.</li>
<li><a href="edges/orientationMap.m">orientationMap.m</a> - generates the orientation map (ie gradient orientation).  Also makes use of the derivative code above.</li>
<li><a href="edges/rescaleDiffImage.m">rescaleDiffImage.m</a> - helper function that shifts and scales the intensities in a derivative image so they are in the range [0,255].  Only used for display purposes.</li>
</ul>
</div>
</div>
<br>
<div id="section">
<div style="background: #ccc; padding: 9px; border-radius: 15px;">
<b style="padding-top: 10px;">Code Description</b>
<p>
I've created a hough function that takes an edge image and the range of $\theta$ values, from the theta values it determines how large of an accumulator image is needed, for simplicity the resolution of the $\rho$ values are set to the same (accumulator is a square image).

The accumulator is generated by iterating over all $\theta$, and calculating $\rho=x cos \theta + y sin \theta$ for each x,y edge point.
</p>
<p>
A second hough_decrement function was created to run a second "decrement" phase, as described in [1].
</p>
<p>
I've made use of my previous edge detection and image smoothing code, as indicated above.  I've copied the edge detection and rescaling (for viewing) functions from the previous edge detection project.
</p>
</div>
</div>
<div id="section">
<h3>EXAMPLES:</h3>
<table>
<tr><td><img id="image" src="images/shapes.png"><br>Original</td><td></td></tr>
<tr><td><img id="image" src="images/shapes_edge.png"><br>Edge map</td><td><img id="image" src="images/shapes_accum.png"><br>Accumulation image ($\theta$ on x-axis, $\rho$ on y-axis)</td></tr>
<tr><td colspan="2">
    <p>
    The above example shows the hough transform for a straight line applied to the edge map of the image with shapes above.  As you can see the accumulator image shows the curves in parameter space representing each of the points on the edge map.
    <p>
    We haven't done any thresholding to the edge map because it is already so clean.
</td></tr>
<tr><td><img id="image" src="images/runway.png"><br>Original</td><td></td></tr>
<tr><td><img id="image" src="images/runway_edge_orig.png"><br>Edge map</td><td><img id="image" src="images/runway_accum_orig.png"><br>Accumulation image ($\theta$ on x-axis, $\rho$ on y-axis)</td></tr>
<tr><td><img id="image" src="images/runway_edge.png"><br>Edge map, with threshold set to 0.3*maximum.</td><td><img id="image" src="images/runway_accum.png"><br>Accumulation image ($\theta$ on x-axis, $\rho$ on y-axis)</td></tr>
<tr><td colspan="2">
    <p>
    Here we see the hough transform for a straight line applied to the edge map of the image with a runway shown above.  Again, the accumulator image shows the curves in parameter space representing each of the points on the edge map. Because this is a real photograph, the edge map has a lot more noise, which causes the accumulator curves to be much less distinct, the process also takes much longer to complete.
    <p>
    To address this problem, we threshold the edge map, to only get the more strong edges, and ignore the weak edges (which will also includes most of the noise). Here we threshold at 0.3*maximum edge value. The result is shown above, as you can see the majority of the runway edge data is still there, but most of the less useful edge and noise data have been removed.  The resulting accumulator image is also much more clean - the individual curves are now distinguishable.
</td></tr>

<tr><td colspan="2">
<h3 style="padding-top: 15px;">Raw Accumulator</h3>
</td></tr>
<tr><td><img id="image" src="images/shapes_accum_points_0.9.png"><br>Maxima (red dots) detected using 0.9*maximum <br>value(dots have been enlarged). (6 maxima)</td><td><img id="image" src="images/shapes_lines_0.9.png"><br>Lines corresponding to the maxima shown the left (threshold of 0.9*maximum).</td></tr>
<tr><td><img id="image" src="images/shapes_accum_points_0.7.png"><br>Maxima (red dots) detected using 0.7*maximum value (47 maxima).</td><td><img id="image" src="images/shapes_lines_0.7.png"><br>Lines corresponding to the maxima shown the left (threshold of 0.7*maximum)</td></tr>
<tr><td colspan="2">
    <p>The above maxima were found without any gaussian blurring of the accumulator, or decrementation.  These are just the maxima of the simple hough transform.  As you can see the process seems to capture the lines and edges pretty well.  If we turn the threshold on the accumulation image down to 0.7*maximum value even more edges are captured.
</td></tr>
<tr><td><img id="image" src="images/runway_accum_points_0.90.png"><br>Maxima (red dots) detected using 0.9*maximum <br>value(dots have been enlarged). (3 maxima)</td><td><img id="image" src="images/runway_lines_0.90.png"><br>Lines corresponding to the maxima shown the left (threshold of 0.9*maximum).</td></tr>
<tr><td><img id="image" src="images/runway_accum_points_0.50.png"><br>Maxima (red dots) detected using 0.5*maximum value (32 maxima).</td><td><img id="image" src="images/runway_lines_0.50.png"><br>Lines corresponding to the maxima shown the left (threshold of 0.5*maximum)</td></tr>
<tr><td colspan="2">
    <p>
    Similarly, here we are finding the maximum on the raw accumulator without any smoothing or decrementing.  As the image shows we are able to capture the main verticle lines of the runway (which is encouraging, since those are the same lines found in the text book on p.737).  If we lower the threshold on the accumulator we are able to find more lines, including the diagonal runway edges, which is cool.
</td></tr>

<tr><td colspan="2">
<h3 style="padding-top: 15px;">Gaussian Blurring on Accumulator</h3>
</td></tr>
<tr><td><img id="image" src="images/shapes_accum_blurred_points_0.95.png"><br>Maxima (red dots) detected using 0.95*maximum <br>value(dots have been enlarged). (4 maxima)</td><td><img id="image" src="images/shapes_blurred_lines_0.95.png"><br>Lines corresponding to the maxima shown the left (threshold of 0.95*maximum)</td></tr>
<tr><td><img id="image" src="images/shapes_accum_blurred_points_0.9.png"><br>Maxima (red dots) detected using 0.9*maximum value (26 maxima).</td><td><img id="image" src="images/shapes_blurred_lines_0.9.png"><br>Lines corresponding to the maxima shown the left (threshold of 0.9*maximum)</td></tr>
<tr><td colspan="2">
    <p>The above maxima were found using gaussian blurring with $\sigma=1$ of the accumulator. With the blurring, more points were closer the the global maximum value (using .9*maximum as threshold still had 26 matches).  This makes sense, as the maximum has probably been lowered by the blurring, and other values may have been increased.
</td></tr>
<tr><td><img id="image" src="images/runway_accum_blurred_points_0.95.png"><br>Maxima (red dots) detected using 0.95*maximum <br>value(dots have been enlarged). (5 maxima)</td><td><img id="image" src="images/runway_blurred_lines_0.95.png"><br>Lines corresponding to the maxima shown the left (threshold of 0.95*maximum)</td></tr>
<tr><td><img id="image" src="images/runway_accum_blurred_points_0.9.png"><br>Maxima (red dots) detected using 0.9*maximum value (9 maxima).</td><td><img id="image" src="images/runway_blurred_lines_0.9.png"><br>Lines corresponding to the maxima shown the left (threshold of 0.9*maximum)</td></tr>
<tr><td colspan="2">
    <p>Similarly, the above maxima were found using gaussian blurring with $\sigma=1$ of the accumulator. However one interesting difference is that the blurring doesn't seem to have as drastic an effect on the number of extrema found at the threshold.  In this case at 0.9*maximum found 5 instead of 3 (for the shapes image it changed from 6 to 26).
</td></tr>

<tr><td colspan="2">
<h3 style="padding-top: 15px;">Decrementor on Accumulator</h3>
</td></tr>
<tr><td><img id="image" src="images/shapes_accum_decr_points_0.9.png"><br>Maxima (red dots) detected using 0.9*maximum <br>value(dots have been enlarged). (5 maxima)</td><td><img id="image" src="images/shapes_decr_lines_0.9.png"><br>Lines corresponding to the maxima shown the left (threshold of 0.9*maximum)</td></tr>
<tr><td><img id="image" src="images/shapes_accum_decr_points_0.7.png"><br>Maxima (red dots) detected using 0.7*maximum value (18 maxima).</td><td><img id="image" src="images/shapes_decr_lines_0.7.png"><br>Lines corresponding to the maxima shown the left (threshold of 0.7*maximum)</td></tr>
<tr><td colspan="2">
    <p>These maxima were found using the decrementation approach described in the [1]. Decremenation does a great job of cleaning up the accumulator, now very few (maxima) points are left, which makes the maxima discovery much more straightforward.  The curves are no longer visible (decremented away), but the maxima are still available.
    <p>
    The result above show taht we are able to again find more lines.  Some lines that weren't discovered in the raw or Gaussian approaches can now be discovered more easily.
</td></tr>
<tr><td><img id="image" src="images/runway_accum_decr_points_0.9.png"><br>Maxima (red dots) detected using 0.9*maximum <br>value(dots have been enlarged). (5 maxima)</td><td><img id="image" src="images/runway_decr_lines_0.9.png"><br>Lines corresponding to the maxima shown the left (threshold of 0.9*maximum)</td></tr>
<tr><td><img id="image" src="images/runway_accum_decr_points_0.7.png"><br>Maxima (red dots) detected using 0.7*maximum value (18 maxima).</td><td><img id="image" src="images/runway_decr_lines_0.7.png"><br>Lines corresponding to the maxima shown the left (threshold of 0.7*maximum)</td></tr>
<tr><td colspan="2">
    <p> The story is very similar for this image.  The decrementation strategy really cleans up the accumulator and we are able to find the same vertical lines in the image.
</td></tr>

<tr><td colspan="2">
<h3 style="padding-top: 15px;">Limit Accumulation using Edge Orientation</h3>
</td></tr>
<tr><td><img id="image" src="images/shapes_ori.png"><br>Orientation image.</td><td></td></tr>
<tr><td><img id="image" src="images/shapes_accum_ori_points_0.9.png"><br>Maxima (red dots) detected using 0.9*maximum <br>value(dots have been enlarged). (5 maxima)</td><td><img id="image" src="images/shapes_ori_lines_0.9.png"><br>Lines corresponding to the maxima shown the left (threshold of 0.9*maximum)</td></tr>
<tr><td><img id="image" src="images/shapes_accum_ori_points_0.7.png"><br>Maxima (red dots) detected using 0.7*maximum value (23 maxima).</td><td><img id="image" src="images/shapes_ori_lines_0.7.png"><br>Lines corresponding to the maxima shown the left (threshold of 0.7*maximum)</td></tr>
<tr><td colspan="2">
    <p>
    Another approach to speeding up the accumulation step is to limit the $\theta$ parameter using the edge orientation of the edge points.  The resulting accumulation image is shown above.  It's interesting to note that while we are limiting $\theta$ (x-axis) the most drastic/noticeable breaks in the curves is along the $\rho$ parameter (y-axis).
    <p>
    The approach appears successful, as you can see above the appropriate lines are detected again, but with much less computation.  If we lower the threshold we find additional lines like before. 
</td></tr>
<tr><td><img id="image" src="images/runway_ori.png"><br>Orientation image.</td><td></td></tr>
<tr><td><img id="image" src="images/runway_accum_ori_points_0.9.png"><br>Maxima (red dots) detected using 0.9*maximum <br>value(dots have been enlarged). (1 maxima)</td><td><img id="image" src="images/runway_ori_lines_0.9.png"><br>Lines corresponding to the maxima shown the left (threshold of 0.9*maximum)</td></tr>
<tr><td><img id="image" src="images/runway_accum_ori_points_0.7.png"><br>Maxima (red dots) detected using 0.7*maximum value (4 maxima).</td><td><img id="image" src="images/runway_ori_lines_0.7.png"><br>Lines corresponding to the maxima shown the left (threshold of 0.7*maximum)</td></tr>
<tr><td colspan="2">
    <p> 
    The results for this image are very similar. We are able to compute the accumulator image very quickly, but the results are largely successful.  In this particular instance we only get one of the vertical edges.  
</td></tr>



</table>

</div>
<h3>References:</h3>
<ol>
  <li>Gerig, G. "Linking Image-Space and Accumulator-Space: A New Approach for Object-Recognition". ICCV 1987.</li>
</ol>

</body>
</html>
